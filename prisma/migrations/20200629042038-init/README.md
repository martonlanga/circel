# Migration `20200629042038-init`

This migration has been generated by martonlanga at 6/29/2020, 4:20:38 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"endOfCampaign" timestamp(3)   ,"ethBounty" Decimal(65,30)   ,"id" text  NOT NULL ,"profileImageUrl" text  NOT NULL ,"token" text  NOT NULL ,"tokenSecret" text  NOT NULL ,"uploadedFollowersCount" integer   ,"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Follower" (
"createdAt" timestamp(3)  NOT NULL ,"defaultProfile" boolean  NOT NULL ,"defaultProfileImage" boolean  NOT NULL ,"description" text   ,"favouritesCount" integer  NOT NULL ,"followersCount" integer  NOT NULL ,"friendsCount" integer  NOT NULL ,"id" SERIAL,"lastStatusDate" timestamp(3)   ,"listedCount" integer  NOT NULL ,"location" text   ,"name" text  NOT NULL ,"profileBannerUrl" text   ,"profileImageUrl" text  NOT NULL ,"protected" boolean  NOT NULL ,"screenName" text  NOT NULL ,"statusesCount" integer  NOT NULL ,"twitterId" text  NOT NULL ,"url" text   ,"userId" text  NOT NULL ,"verified" boolean  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Message" (
"active" boolean  NOT NULL DEFAULT false,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"filters" text   ,"id" SERIAL,"message" text  NOT NULL ,"name" text  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Dm" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"followerId" integer  NOT NULL ,"id" SERIAL,"messageId" integer  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Email" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"id" SERIAL,"refId" text   ,"userId" text  NOT NULL ,"verificationToken" text  NOT NULL ,"verified" boolean  NOT NULL DEFAULT false,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Ref" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"ethAddress" text   ,"id" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_RefToUser" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "User.username" ON "public"."User"("username")

CREATE UNIQUE INDEX "_RefToUser_AB_unique" ON "public"."_RefToUser"("A","B")

CREATE  INDEX "_RefToUser_B_index" ON "public"."_RefToUser"("B")

ALTER TABLE "public"."Follower" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Dm" ADD FOREIGN KEY ("followerId")REFERENCES "public"."Follower"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Dm" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Dm" ADD FOREIGN KEY ("messageId")REFERENCES "public"."Message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Email" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Email" ADD FOREIGN KEY ("refId")REFERENCES "public"."Ref"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_RefToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Ref"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RefToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200629042038-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,98 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model User {
+  id                     String     @id // twitterId
+  createdAt              DateTime   @default(now())
+  username               String     @unique // screenName
+  token                  String
+  tokenSecret            String
+  profileImageUrl        String
+  ethBounty              Float?
+  endOfCampaign          DateTime?
+  uploadedFollowersCount Int?
+  followers              Follower[]
+  messages               Message[]
+  emails                 Email[]
+  refs                   Ref[]
+  dms                    Dm[]
+}
+
+// https://developer.twitter.com/en/docs/tweets/data-dictionary/overview/user-object
+model Follower {
+  id     Int    @default(autoincrement()) @id
+  user   User   @relation(fields: [userId], references: [id])
+  userId String
+  dms    Dm[]
+
+  twitterId           String
+  name                String
+  screenName          String
+  location            String?
+  description         String? // bio
+  url                 String?
+  protected           Boolean
+  followersCount      Int
+  friendsCount        Int // their followings
+  listedCount         Int
+  createdAt           DateTime
+  favouritesCount     Int
+  verified            Boolean
+  statusesCount       Int
+  lastStatusDate      DateTime?
+  profileImageUrl     String // https
+  profileBannerUrl    String?
+  defaultProfile      Boolean
+  defaultProfileImage Boolean
+}
+
+model Message {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  name      String
+  message   String
+  dms       Dm[]
+  user      User     @relation(fields: [userId], references: [id])
+  userId    String
+  filters   String?
+  active    Boolean  @default(false)
+}
+
+model Dm {
+  id         Int      @default(autoincrement()) @id
+  createdAt  DateTime @default(now())
+  follower   Follower @relation(fields: [followerId], references: [id])
+  followerId Int
+  user       User     @relation(fields: [userId], references: [id])
+  userId     String
+  message    Message  @relation(fields: [messageId], references: [id])
+  messageId  Int
+}
+
+model Email {
+  id                Int      @default(autoincrement()) @id
+  createdAt         DateTime @default(now())
+  email             String
+  verified          Boolean  @default(false)
+  verificationToken String
+  user              User     @relation(fields: [userId], references: [id])
+  userId            String
+  ref               Ref?     @relation(fields: [refId], references: [id])
+  refId             String?
+}
+
+// every email is also a referrer? -> problem: can't sign up to diff incluencers using diff emails
+model Ref {
+  // will be created when first person using referrer's link signs up
+  id         String   @id // twitter screen name
+  createdAt  DateTime @default(now())
+  ethAddress String?
+  users      User[]
+  referrals  Email[]
+}
```


